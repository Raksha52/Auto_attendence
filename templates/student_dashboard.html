<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      /* Page background and general layout */
      html,body { height:100%; }
      body {
        background: linear-gradient(135deg, #f5f7fa 0%, #c3e0ff 35%, #e8f0ff 100%);
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
        color: #0f172a;
        -webkit-font-smoothing:antialiased;
      }
      .dashboard-wrapper {
        min-height: calc(100vh - 72px);
        display:flex;
        align-items:flex-start;
        padding: 3rem 0;
      }
      /* translucent card background */
      .translucent-card { background-color: rgba(255,255,255,0.82); border: none; }
      .translucent-card .card-body { backdrop-filter: blur(6px); }

      /* Navbar tweaks */
      .navbar-overlay { background: rgba(255,255,255,0.6); box-shadow: 0 2px 8px rgba(2,6,23,0.06); }

      /* Subject card tweaks */
      .subject-card { border-radius: .6rem; box-shadow: 0 6px 20px rgba(2,6,23,0.05); border:1px solid rgba(15,23,42,0.04); }
      .subject-card .color-strip { width:8px; border-radius:6px 0 0 6px; margin-right:0.75rem; }
      .subject-row { display:flex; align-items:stretch; }
      .subject-header { display:flex; align-items:center; justify-content:space-between; gap:1rem; }
      .subject-title { font-size:1rem; font-weight:700; }
      .attendance-badge { font-size:.9rem; }
      .today-badge { font-size:.85rem; }
      .subject-list a { text-decoration:none; color:inherit; }
      .subject-list a:hover { text-decoration:underline; }
      /* color classes for left strip */
      .att-high { background: linear-gradient(90deg,#10b981,#059669); } /* green */
      .att-mid { background: linear-gradient(90deg,#f59e0b,#d97706); } /* amber */
      .att-low { background: linear-gradient(90deg,#ef4444,#dc2626); } /* red */
      /* subtle background tints for card bodies */
      .bg-att-high { background-color: rgba(16,185,129,0.06); }
      .bg-att-mid { background-color: rgba(245,158,11,0.06); }
      .bg-att-low { background-color: rgba(239,68,68,0.06); }
      .dot { display:inline-block; width:10px; height:10px; border-radius:50%; margin-right:.5rem; vertical-align:middle; }
      /* right column card slightly transparent */
      .side-card { background: rgba(255,255,255,0.9); border:1px solid rgba(2,6,23,0.04); }
    </style>
</head>
<body>
<nav class="navbar navbar-light bg-light">
  <div class="container-fluid">
    <span class="navbar-brand mb-0 h1">Welcome, {{ student.name }}</span>
    <div>
      <a class="btn btn-outline-primary me-2" href="{{ url_for('upload_face', student_id=student.id) }}">Upload Face</a>
      <a class="btn btn-outline-danger" href="{{ url_for('student_logout') }}">Logout</a>
    </div>
  </div>
  </nav>

<div class="dashboard-wrapper">
  <div class="container py-4">
  <div class="row">
    <div class="col-md-8">
      <div class="card mb-3 translucent-card">
        <div class="card-body">
          <h5 class="card-title">Subjects & Attendance</h5>
          <p class="text-muted">Overview of attendance per subject</p>
          <!-- Percent is always visible now -->

          {% if subject_stats %}
            <div class="mb-3 d-md-none">
              <small class="text-muted">Tap a subject in the menu to jump to it.</small>
            </div>
            {% for s in subject_stats %}
              {% set p = (s.percent if s.percent is not none else 0) %}
              <div id="subj-{{ s.subject.id }}" class="mb-3">
                <div class="card subject-card">
                  <div class="card-body">
                    <div class="subject-row">
                      <div class="color-strip" data-percent="{{ p }}" data-status="{{ s.today_status }}"></div>
                      <div style="flex:1">
                        <div class="subject-header">
                      <div>
                        <div class="subject-title">{{ s.subject.name }} <small class="text-muted">({{ s.subject.code }})</small></div>
                        <div class="small text-muted mt-1">Total: {{ s.total }} &middot; Present: {{ s.present }}</div>
                      </div>
                      <div class="text-end">
                        <span class="badge bg-primary attendance-badge">{% if s.percent is not none %}{{ s.percent }}%{% else %}â€”{% endif %}</span>
                        <div class="mt-1">
                          <span class="badge today-badge {% if s.today_status=='present' %}bg-success{% else %}bg-danger{% endif %}">{{ s.today_status|capitalize }}</span>
                        </div>
                      </div>
                    </div>
                    <div class="progress mt-3" style="height:12px">
                      <div class="progress-bar" role="progressbar" data-percent="{{ p }}" style="width:0%;" aria-valuemin="0" aria-valuemax="100"></div>
                    </div>
                  </div>
                </div>
              </div>
            {% endfor %}
          {% else %}
            <p class="text-muted">No subjects assigned yet.</p>
          {% endif %}
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card mb-3 side-card">
        <div class="card-body">
          <h6 class="card-title">Subjects</h6>
          <ul class="list-unstyled mb-0">
            {% for s in subject_stats %}
              <li><a href="#subj-{{ s.subject.id }}">{{ s.subject.name }} ({{ s.subject.code }})</a></li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // set progress bars from data-percent (safe: only if any progress bars exist)
  var bars = document.querySelectorAll('.progress-bar');
  if (bars && bars.length) {
    bars.forEach(function(bar){
      var p = parseFloat(bar.getAttribute('data-percent') || '0') || 0;
      bar.style.width = p + '%';
      bar.setAttribute('aria-valuenow', p);
    });
  }

  // Color the left strip and badges based on percent and today's status
  document.querySelectorAll('.subject-card').forEach(function(card){
    var strip = card.querySelector('.color-strip');
    var badge = card.querySelector('.attendance-badge');
    var cardBody = card.querySelector('.card-body');
    var status = strip && strip.getAttribute('data-status');
    var p = parseFloat(strip && strip.getAttribute('data-percent') || '0') || 0;
    var className = 'att-low';
    var bgClass = 'bg-att-low';
    if (p >= 75) { className = 'att-high'; bgClass = 'bg-att-high'; }
    else if (p >= 40) { className = 'att-mid'; bgClass = 'bg-att-mid'; }
    if (strip) strip.classList.add(className);
    if (cardBody) {
      cardBody.classList.remove('bg-att-high','bg-att-mid','bg-att-low');
      cardBody.classList.add(bgClass);
    }
    if (badge) {
      badge.classList.remove('bg-primary','bg-success','bg-warning','bg-danger');
      if (p >= 75) { badge.classList.add('bg-success'); }
      else if (p >= 40) { badge.classList.add('bg-warning'); }
      else { badge.classList.add('bg-danger'); }
    }
  });

  // Add colored dots in the side list
  var sideList = document.querySelectorAll('.col-md-4 .list-unstyled li');
  sideList.forEach(function(li){
    var href = li.querySelector('a');
    if (!href) return;
    var target = document.querySelector(href.getAttribute('href'));
    var percent = 0;
    var status = '';
    if (target) {
      var strip = target.querySelector('.color-strip');
      percent = parseFloat(strip && strip.getAttribute('data-percent') || '0') || 0;
      status = strip && strip.getAttribute('data-status');
    }
    var dot = document.createElement('span');
    dot.className = 'dot';
    if (percent >= 75) dot.style.background = '#10b981';
    else if (percent >= 40) dot.style.background = '#f59e0b';
    else dot.style.background = '#ef4444';
    li.insertBefore(dot, li.firstChild);
  });
</script>
</body>
</html>


